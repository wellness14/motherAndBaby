/*!
 * jQuery Popup Overlay
 *
 * @version 1.7.3
 * @requires jQuery v1.7.1+
 * @link http://vast-engineering.github.com/jquery-popup-overlay/
 */
(function(e){var b=e(window);var o={};var m=[];var c=[];var l;var a=null;var g="_open";var i="_close";var k=[];var h=null;var f;var j=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);var d={_init:function(r){var q=e(r);var p=q.data("popupoptions");c[r.id]=false;m[r.id]=0;if(!q.data("popup-initialized")){q.attr("data-popup-initialized","true");d._initonce(r)}if(p.autoopen){setTimeout(function(){d.show(r,0)},0)}},_initonce:function(q){var y=e(q);var s=e("body");var u;var z=y.data("popupoptions");var t;a=parseInt(s.css("margin-right"),10);h=document.body.style.webkitTransition!==undefined||document.body.style.MozTransition!==undefined||document.body.style.msTransition!==undefined||document.body.style.OTransition!==undefined||document.body.style.transition!==undefined;if(z.type=="tooltip"){z.background=false;z.scrolllock=false}if(z.backgroundactive){z.background=false;z.blur=false;z.scrolllock=false}if(z.scrolllock){var w;var p;if(typeof l==="undefined"){w=e('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body");p=w.children();l=p.innerWidth()-p.height(99).innerWidth();w.remove()}}if(!y.attr("id")){y.attr("id","j-popup-"+parseInt((Math.random()*100000000),10))}y.addClass("popup_content");s.prepend(q);y.wrap('<div id="'+q.id+'_wrapper" class="popup_wrapper" />');u=e("#"+q.id+"_wrapper");u.css({opacity:0,visibility:"hidden",position:"absolute"});if(j){u.css("cursor","pointer")}if(z.type=="overlay"){u.css("overflow","auto")}y.css({opacity:0,visibility:"hidden",display:"inline-block"});if(z.setzindex&&!z.autozindex){u.css("z-index","100001")}if(!z.outline){y.css("outline","none")}if(z.transition){y.css("transition",z.transition);u.css("transition",z.transition)}y.attr("aria-hidden",true);if((z.background)&&(!e("#"+q.id+"_background").length)){s.prepend('<div id="'+q.id+'_background" class="popup_background"></div>');var v=e("#"+q.id+"_background");v.css({opacity:0,visibility:"hidden",backgroundColor:z.color,position:"fixed",top:0,right:0,bottom:0,left:0});if(z.setzindex&&!z.autozindex){v.css("z-index","100000")}if(z.transition){v.css("transition",z.transition)}}if(z.type=="overlay"){y.css({textAlign:"left",position:"relative",verticalAlign:"middle"});t={position:"fixed",width:"100%",height:"100%",top:0,left:0,textAlign:"center"};if(z.backgroundactive){t.position="relative";t.height="0";t.overflow="visible"}u.css(t);u.append('<div class="popup_align" />');e(".popup_align").css({display:"inline-block",verticalAlign:"middle",height:"100%"})}y.attr("role","dialog");var r=(z.openelement)?z.openelement:("."+q.id+g);e(r).each(function(A,B){e(B).attr("data-popup-ordinal",A);if(!B.id){e(B).attr("id","open_"+parseInt((Math.random()*100000000),10))}});if(!(y.attr("aria-labelledby")||y.attr("aria-label"))){y.attr("aria-labelledby",e(r).attr("id"))}var x=(z.closeelement)?z.closeelement:("."+q.id+i);e(document).on("click",x,function(A){d.hide(q);A.preventDefault()});if(z.action=="hover"){z.keepfocus=false;e(r).on("mouseenter",function(A){d.show(q,e(this).data("popup-ordinal"))});e(r).on("mouseleave",function(A){d.hide(q)})}else{e(document).on("click",r,function(B){B.preventDefault();var A=e(this).data("popup-ordinal");setTimeout(function(){d.show(q,A)},0)})}if(z.detach){y.hide().detach()}else{u.hide()}},show:function(q,v){var z=e(q);if(z.data("popup-visible")){return}if(!z.data("popup-initialized")){d._init(q)}z.attr("data-popup-initialized","true");var r=e("body");var A=z.data("popupoptions");var u=e("#"+q.id+"_wrapper");var x=e("#"+q.id+"_background");n(q,v,A.beforeopen);c[q.id]=v;setTimeout(function(){k.push(q.id)},0);if(A.autozindex){var p=document.getElementsByTagName("*");var t=p.length;var y=0;for(var s=0;s<t;s++){var w=e(p[s]).css("z-index");if(w!=="auto"){w=parseInt(w,10);if(y<w){y=w}}}m[q.id]=y;if(A.background){if(m[q.id]>0){e("#"+q.id+"_background").css({zIndex:(m[q.id]+1)})}}if(m[q.id]>0){u.css({zIndex:(m[q.id]+2)})}}if(A.detach){u.prepend(q);z.show()}else{u.show()}f=setTimeout(function(){u.css({visibility:"visible",opacity:1});e("html").addClass("popup_visible").addClass("popup_visible_"+q.id);z.addClass("popup_content_visible")},20);if(A.scrolllock){r.css("overflow","hidden");if(r.height()>b.height()){r.css("margin-right",a+l)}}if(A.backgroundactive){z.css({top:(b.height()-(z.get(0).offsetHeight+parseInt(z.css("margin-top"),10)+parseInt(z.css("margin-bottom"),10)))/2+"px",})}z.css({visibility:"visible",opacity:1});if(A.background){x.css({visibility:"visible",opacity:A.opacity});setTimeout(function(){x.css({opacity:A.opacity})},0)}z.data("popup-visible",true);d.reposition(q,v);z.data("focusedelementbeforepopup",document.activeElement);if(A.keepfocus){z.attr("tabindex",-1);setTimeout(function(){if(A.focuselement==="closebutton"){e("#"+q.id+" ."+q.id+i+":first").focus()}else{if(A.focuselement){e(A.focuselement).focus()}else{z.focus()}}},A.focusdelay)}e(A.pagecontainer).attr("aria-hidden",true);z.attr("aria-hidden",false);n(q,v,A.onopen);if(h){u.one("transitionend",function(){n(q,v,A.opentransitionend)})}else{n(q,v,A.opentransitionend)}},hide:function(s){if(f){clearTimeout(f)}var u=e("body");var r=e(s);var q=r.data("popupoptions");var t=e("#"+s.id+"_wrapper");var p=e("#"+s.id+"_background");r.data("popup-visible",false);if(k.length===1){e("html").removeClass("popup_visible").removeClass("popup_visible_"+s.id)}else{if(e("html").hasClass("popup_visible_"+s.id)){e("html").removeClass("popup_visible_"+s.id)}}k.pop();if(e("html").hasClass("popup_content_visible")){r.removeClass("popup_content_visible")}if(q.keepfocus){setTimeout(function(){if(e(r.data("focusedelementbeforepopup")).is(":visible")){r.data("focusedelementbeforepopup").focus()}},0)}t.css({visibility:"hidden",opacity:0});r.css({visibility:"hidden",opacity:0});if(q.background){p.css({visibility:"hidden",opacity:0})}e(q.pagecontainer).attr("aria-hidden",false);r.attr("aria-hidden",true);n(s,c[s.id],q.onclose);if(h&&r.css("transition-duration")!=="0s"){r.one("transitionend",function(v){if(!(r.data("popup-visible"))){if(q.detach){r.hide().detach()}else{t.hide()}}if(q.scrolllock){setTimeout(function(){u.css({overflow:"visible","margin-right":a})},10)}n(s,c[s.id],q.closetransitionend)})}else{if(q.detach){r.hide().detach()}else{t.hide()}if(q.scrolllock){setTimeout(function(){u.css({overflow:"visible","margin-right":a})},10)}n(s,c[s.id],q.closetransitionend)}},toggle:function(q,p){if(e(q).data("popup-visible")){d.hide(q)}else{setTimeout(function(){d.show(q,p)},0)}},reposition:function(t,p){var s=e(t);var r=s.data("popupoptions");var u=e("#"+t.id+"_wrapper");var q=e("#"+t.id+"_background");p=p||0;if(r.type=="tooltip"){u.css({position:"absolute"});var v;if(r.tooltipanchor){v=e(r.tooltipanchor)}else{if(r.openelement){v=e(r.openelement).filter('[data-popup-ordinal="'+p+'"]')}else{v=e("."+t.id+g+'[data-popup-ordinal="'+p+'"]')}}var w=v.offset();if(r.horizontal=="right"){u.css("left",w.left+v.outerWidth()+r.offsetleft)}else{if(r.horizontal=="leftedge"){u.css("left",w.left+v.outerWidth()-v.outerWidth()+r.offsetleft)}else{if(r.horizontal=="left"){u.css("right",b.width()-w.left-r.offsetleft)}else{if(r.horizontal=="rightedge"){u.css("right",b.width()-w.left-v.outerWidth()-r.offsetleft)}else{u.css("left",w.left+(v.outerWidth()/2)-(s.outerWidth()/2)-parseFloat(s.css("marginLeft"))+r.offsetleft)}}}}if(r.vertical=="bottom"){u.css("top",w.top+v.outerHeight()+r.offsettop)}else{if(r.vertical=="bottomedge"){u.css("top",w.top+v.outerHeight()-s.outerHeight()+r.offsettop)}else{if(r.vertical=="top"){u.css("bottom",b.height()-w.top-r.offsettop)}else{if(r.vertical=="topedge"){u.css("bottom",b.height()-w.top-s.outerHeight()-r.offsettop)}else{u.css("top",w.top+(v.outerHeight()/2)-(s.outerHeight()/2)-parseFloat(s.css("marginTop"))+r.offsettop)}}}}}else{if(r.type=="overlay"){if(r.horizontal){u.css("text-align",r.horizontal)}else{u.css("text-align","center")}if(r.vertical){s.css("vertical-align",r.vertical)}else{s.css("vertical-align","middle")}}}}};var n=function(r,p,s){var q=(o.openelement)?o.openelement:("."+r.id+g);var t=e(q+'[data-popup-ordinal="'+p+'"]');if(typeof s=="function"){s.call(e(r),r,t)}};e(document).on("keydown",function(r){if(k.length){var p=k[k.length-1];var q=document.getElementById(p);if(e(q).data("popupoptions").escape&&r.keyCode==27&&e(q).data("popup-visible")){d.hide(q)}}});e(document).on("click",function(r){if(k.length){var p=k[k.length-1];var q=document.getElementById(p);if(e(q).data("popupoptions").blur&&!e(r.target).parents().andSelf().is("#"+p)&&e(q).data("popup-visible")&&r.which!==2){d.hide(q);if(e(q).data("popupoptions").type==="overlay"){r.preventDefault()}}}});e(document).on("focusin",function(r){if(k.length){var p=k[k.length-1];var q=document.getElementById(p);if(e(q).data("popupoptions").keepfocus){if(!q.contains(r.target)){r.stopPropagation();q.focus()}}}});e.fn.popup=function(p){return this.each(function(){$el=e(this);if(typeof p==="object"){var q=e.extend({},e.fn.popup.defaults,p);$el.data("popupoptions",q);o=$el.data("popupoptions");d._init(this)}else{if(typeof p==="string"){if(!($el.data("popupoptions"))){$el.data("popupoptions",e.fn.popup.defaults);o=$el.data("popupoptions")}d[p].call(this,this)}else{if(!($el.data("popupoptions"))){$el.data("popupoptions",e.fn.popup.defaults);o=$el.data("popupoptions")}d._init(this)}}})};e.fn.popup.defaults={type:"overlay",autoopen:false,background:true,backgroundactive:false,color:"black",opacity:"0.5",horizontal:"center",vertical:"middle",offsettop:0,offsetleft:0,escape:true,blur:true,setzindex:true,autozindex:false,scrolllock:false,keepfocus:true,focuselement:null,focusdelay:50,outline:false,pagecontainer:null,detach:false,openelement:null,closeelement:null,transition:null,tooltipanchor:null,beforeopen:null,onclose:null,onopen:null,opentransitionend:null,closetransitionend:null}})(jQuery);